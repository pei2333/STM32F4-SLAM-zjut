# SLAM 建图项目说明文档

## 项目概述
基于 STM32F4 的 SLAM 建图系统，使用激光雷达和加速度计实现实时建图和定位。

## 硬件模块
1. N10P 激光雷达
   - 接口：UART5（460800bps）
   - 功能：提供 32 点/帧的激光扫描数据
   - 数据格式：108 字节/帧，包含距离和强度信息

2. ADXL345 加速度计
   - 接口：SPI
   - 功能：提供三轴加速度数据
   - 数据处理：包含低通滤波、高通滤波和滑动平均

3. GPIO 按键
   - KEY1：开始/暂停 SLAM
   - KEY2：清空地图
   - KEY3：重置位置

4. LCD 触摸屏
   - 驱动：LVGL 库
   - 功能：显示地图和操作界面
   - 支持：触摸平移视图

## 软件功能
1. SLAM 建图
   - 实时地图构建
   - 动态障碍检测
   - 机器人位姿更新

2. 数据处理
   - 激光雷达数据解析
   - 加速度计数据滤波
   - 位姿积分计算

3. 用户界面
   - 实时地图显示
   - 机器人位置和朝向显示
   - 触摸控制
   - 按键控制

## 代码结构
1. 主要文件
   - `main.c`：主程序，包含 SLAM 实现
   - `adxl345.c/h`：加速度计驱动
   - `USART.c/h`：串口通信
   - LVGL 相关文件

2. 关键函数
   - `SystemInit()`：系统初始化
   - `SLAM_Process()`：SLAM 主循环
   - `enhancedUpdateMapWithLaserData()`：地图更新
   - `drawMap()`：地图显示

## 使用说明
1. 系统启动
   - 系统自动初始化所有硬件
   - 显示初始地图界面

2. 操作控制
   - 按键控制：
     * KEY1：开始/暂停 SLAM
     * KEY2：清空地图
     * KEY3：重置位置
   - 触摸控制：
     * 触摸拖动：平移地图视图

3. 显示说明
   - 灰色：未知区域
   - 白色：自由区域
   - 黑色：障碍物
   - 红色：机器人位置
   - 蓝色：动态障碍
   - 绿色：机器人朝向

## 注意事项
1. 硬件连接
   - 确保激光雷达正确连接到 UART5
   - 检查 ADXL345 的 SPI 连接
   - 验证按键和触摸屏连接

2. 使用建议
   - 首次使用时进行地图清空
   - 保持机器人稳定移动
   - 避免剧烈震动

3. 性能优化
   - 地图更新频率：10Hz
   - 显示刷新频率：10Hz
   - 加速度计采样：200Hz



N10P雷达的数据读取方式如下：

---

### 🔌 1. 接线定义

* 雷达使用串口通信（默认波特率 **460800 bps**）。
* 典型连接：

  * GND ↔ GND
  * TX（雷达）→ MCU 的 RX（接收）
  * VCC ↔ 5V
  * RX 可不接（雷达只发不收）

---

### 📦 2. 输出数据格式（总长108字节）

| 字节范围    | 内容                               | 描述                |
| ------- | -------------------------------- | ----------------- |
| 0-1     | `0xA5 0x5A`                      | 帧头                |
| 2       | Length                           | 固定为108字节          |
| 3-4     | Speed\_H, Speed\_L               | 一个齿的转动时间（单位：us）   |
| 5-6     | Start\_angle\_H, Start\_angle\_L | 起始角度（单位：角度×100）   |
| 7-102   | 点云数据（32个点 × 3字节）                 | 每个点：2字节距离 + 1字节强度 |
| 103-104 | 保留位                              | 可忽略               |
| 105-106 | Stop\_angle\_H, Stop\_angle\_L   | 结束角度（单位：角度×100）   |
| 107     | CRC校验                            | 前107字节加和（低8位）     |

---

### 📊 3. 点云数据结构（Byte\_7 到 Byte\_102）

* 每个"点"由 **3个字节**构成：

  * 2字节距离值（单位：mm，高位在前）
  * 1字节强度值（PEAK）
* 一帧共输出**32个点**
* 同一个角度对应两个点（可能是不同层级或多回波）

---

### 🔄 4. 数据示例解析（参考N10，同理）

* 起始角度例：`0x42 0x08` → `0x4208 = 16904` → 169.04°
* 距离例：`0x01 0x2C` → `300mm`
* 强度例：`0x64` → 强度值100

---

### 🧮 5. 数据处理流程（建议）

1. 在串口接收缓冲区中识别帧头 `A5 5A`。
2. 确认长度为108字节。
3. 读取并解析起始角度与点云数据。
4. 根据角度范围和点数计算每个点对应的角度（0.4°间隔）。
5. 对距离和强度进行应用处理（如避障、建图等）。

---

### 🧭 6. 坐标定义

N10P 的坐标系与 N10 相同：

* 0° 为正前方，顺时针为正方向。
* 每帧点云覆盖角度约为 12°，一圈约 900 个点（360° / 0.4°）。

---
