# STM32F4 SLAM建图系统 浙江工业大学单片机课程设计

## 项目概述

这是一个基于STM32F4的SLAM（同步定位与建图）系统，通过整合N10P激光雷达和ADXL345加速度传感器，实现了实时环境建图和自主定位功能。系统使用LVGL库提供图形界面，支持触摸交互和实时地图显示。

## 主要功能

- **实时SLAM建图**：利用激光雷达数据构建环境地图
- **惯性导航定位**：通过ADXL345加速度计进行位姿估计
- **传感器融合**：结合激光测距和惯性测量提高定位精度
- **地图可视化**：实时显示建图结果和机器人位置
- **触摸交互**：支持触摸屏幕平移地图视图
- **多模式切换**：支持DEBUG和SLAM两种工作模式

## 硬件组件

1. **STM32F4微控制器**：系统核心处理单元
2. **N10P激光雷达**
   - 接口：UART5（460800bps）
   - 功能：提供32点/帧的激光扫描数据
   - 数据格式：108字节/帧，包含距离和强度信息

3. **ADXL345加速度计**
   - 接口：软件模拟SPI/I2C
   - 功能：提供三轴加速度数据
   - 采样率：200Hz

4. **液晶触摸屏**
   - 分辨率：480×800
   - 驱动：LVGL图形库
   - 功能：显示地图和操作界面

5. **按键控制**
   - KEY1：切换DEBUG/SLAM模式
   - KEY2：静止模式/清空地图
   - KEY3：运动模式/重置位置

## 软件架构

- **基础驱动层**：包含各硬件模块的底层驱动
  - UART5驱动：用于激光雷达通信
  - ADXL345驱动：用于加速度计数据采集
  - LCD/触摸屏驱动：用于显示和交互

- **SLAM算法层**：
  - 地图构建与更新
  - 位姿估计与更新
  - 传感器数据过滤与融合

- **应用层**：
  - 用户界面及交互逻辑
  - 模式切换逻辑
  - 系统状态监控

## 开发环境

- 开发工具：Keil MDK
- 语言：C
- 图形库：LVGL
- 调试工具：J-Link

## 使用说明

1. **系统启动**
   - 上电后系统自动初始化并进入默认模式
   - LCD显示初始化界面

2. **模式切换**
   - 按下KEY1切换DEBUG/SLAM模式
   - DEBUG模式：显示传感器原始数据和硬件状态
   - SLAM模式：显示实时建图结果和机器人位置

3. **SLAM模式操作**
   - 按下KEY2：切换静止模式（锁定位置）
   - 按下KEY3：切换运动模式（更新位置）或切换显示模式
   - 触摸屏幕：平移地图视图

4. **地图说明**
   - 灰色：未知区域
   - 白色：自由区域
   - 黑色：障碍物
   - 红色：机器人位置
   - 蓝色：动态障碍
   - 绿色：机器人朝向

## 注意事项

1. **硬件连接**
   - 确保激光雷达正确连接到UART5（PC12/PD2）
   - 确保ADXL345正确连接（PA3/PA6）
   - 检查液晶显示器和触摸屏连接

2. **使用建议**
   - 首次使用时进行地图清空
   - 保持机器人稳定移动
   - 避免剧烈震动影响加速度计读数

3. **性能参数**
   - 地图更新频率：10Hz
   - 显示刷新频率：5Hz（200ms刷新间隔）
   - 加速度计采样频率：200Hz

## 文件结构说明

- `BaseDrive/`：基础驱动程序
  - `USART.c/h`：串口通信驱动
  - `adxl345.c/h`：加速度传感器驱动
  - `KEY.c/h`：按键驱动
  - `ILI93xx.c`：LCD驱动
  - `TOUCH/`：触摸屏驱动

- `User/`：用户应用代码
  - `main.c`：主程序，包含SLAM核心实现
  - `linear_interpolation.c/h`：数据插值算法
  - `PWM.c/h`：PWM控制

- `lvgl/`：LVGL图形库

## 开发与贡献

本项目基于STM32F4平台开发，欢迎通过以下方式参与贡献：

- 提交Issue报告bug或提出新功能建议
- 提交Pull Request改进代码或修复问题
- 优化算法实现，提高定位精度
- 扩展系统功能
